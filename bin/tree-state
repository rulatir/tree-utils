#!/usr/bin/env php
<?php
require __DIR__."/../vendor/autoload.php";

use Rulatir\Tree\State;

$repositoryRoot = rtrim($argv[1], "/\\");
$baseCommitRef = file_exists("{$repositoryRoot}/.tree-state.ref") ? trim(`cat .tree-state.ref`) : 'HEAD';
$repository = new \Rulatir\Tree\GitRepository($repositoryRoot);
$hashing = new \Rulatir\Tree\MD5FileHashing();
$state = new State($repository,$baseCommitRef,$hashing);
$snapshot = $state->getSnapshot();
echo json_encode($snapshot, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES);
